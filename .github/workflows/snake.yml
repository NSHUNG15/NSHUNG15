name: 🐍 Generate Snake Game & Update Profile

on:
  # Runs on every push to main branch
  push:
    branches: [ main, master ]
  
  # Runs on schedule - every 12 hours
  schedule:
    - cron: "0 */12 * * *"
  
  # Allows manual trigger
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate-snake:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      # Checkout repository
      - name: 🛒 Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
        
      # Generate multiple snake themes
      - name: 🐍 Generate snake game - Light Theme
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: NSHUNG15
          outputs: |
            github-contribution-grid-snake.svg
            github-contribution-grid-snake-light.svg?palette=github-light
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 🌙 Generate snake game - Dark Theme
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: NSHUNG15
          outputs: |
            github-contribution-grid-snake-dark.svg?palette=github-dark
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 🎨 Generate snake game - Ocean Theme
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: NSHUNG15
          outputs: |
            github-contribution-grid-snake-ocean.svg?palette=ocean_dark
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 🌸 Generate snake game - Pink Theme
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: NSHUNG15
          outputs: |
            github-contribution-grid-snake-pink.svg?palette=pink
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 🎯 Generate snake game - Radical Theme
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: NSHUNG15
          outputs: |
            github-contribution-grid-snake-radical.svg?palette=radical
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 🟢 Generate snake game - Green Theme
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: NSHUNG15
          outputs: |
            github-contribution-grid-snake-green.svg?palette=green
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 🔥 Generate snake game - Fire Theme
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: NSHUNG15
          outputs: |
            github-contribution-grid-snake-fire.svg?palette=fire
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 💜 Generate snake game - Purple Theme
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: NSHUNG15
          outputs: |
            github-contribution-grid-snake-purple.svg?palette=purple
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 🌈 Generate snake game - Rainbow Theme
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: NSHUNG15
          outputs: |
            github-contribution-grid-snake-rainbow.svg?palette=rainbow
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      # Create daily snack commit with themes
      - name: 🍿 Daily snack commit with themes
        run: |
          # Create daily snacks file if it doesn't exist
          if [ ! -f daily-snacks.md ]; then
            echo "# 🍿 Daily Snacks - Multi-Theme Snake Collection!" > daily-snacks.md
            echo "" >> daily-snacks.md
            echo "## 🌈 Available Themes:" >> daily-snacks.md
            echo "- 🐍 **Light Theme** - Clean and minimal" >> daily-snacks.md
            echo "- 🌙 **Dark Theme** - Perfect for dark mode lovers" >> daily-snacks.md
            echo "- 🎨 **Ocean Theme** - Deep blue oceanic vibes" >> daily-snacks.md
            echo "- 🌸 **Pink Theme** - Soft and elegant" >> daily-snacks.md
            echo "- 🎯 **Radical Theme** - Bold and vibrant" >> daily-snacks.md
            echo "- 🟢 **Green Theme** - Natural and fresh" >> daily-snacks.md
            echo "- 🔥 **Fire Theme** - Hot and energetic" >> daily-snacks.md
            echo "- 💜 **Purple Theme** - Royal and mysterious" >> daily-snacks.md
            echo "- 🌈 **Rainbow Theme** - Colorful and fun" >> daily-snacks.md
            echo "" >> daily-snacks.md
            echo "## 📅 Update Log:" >> daily-snacks.md
            echo "" >> daily-snacks.md
          fi
          
          # Array of fun emojis for variety
          emojis=("🍿" "🐍" "🎨" "🌟" "🚀" "🎯" "🔥" "⚡" "💎" "🌈" "🎭" "🎪" "🎨" "🌙" "☀️")
          emoji=${emojis[$RANDOM % ${#emojis[@]}]}
          
          # Array of themes for random selection
          themes=("Light" "Dark" "Ocean" "Pink" "Radical" "Green" "Fire" "Purple" "Rainbow")
          theme=${themes[$RANDOM % ${#themes[@]}]}
          
          # Add today's snack with random theme
          echo "- $emoji $(date '+%Y-%m-%d %H:%M:%S') - Daily snack with $theme theme! 🎨" >> daily-snacks.md
          
          # Keep only last 50 entries (more history for themes)
          tail -n 60 daily-snacks.md > temp-snacks.md
          mv temp-snacks.md daily-snacks.md
          
      # Commit and push all changes
      - name: 🚀 Commit and push changes
        run: |
          git config --local user.email "nshung0105@gmail.com"
          git config --local user.name "Nguyễn Sinh Hùng"
          git add .
          
          # Check if there are changes to commit
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "🌈 Update multi-theme snake collection and daily snack [automated] $(date '+%Y-%m-%d')"
            git push
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  update-readme:
    runs-on: ubuntu-latest
    needs: generate-snake
    if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
    
    steps:
      - name: 🛒 Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
        
      # Update README timestamp
      - name: 📊 Update README stats
        run: |
          # Create a simple stats update
          echo "Last updated: $(date '+%Y-%m-%d %H:%M:%S')" > last-update.txt
          
      # Commit README updates
      - name: 🔄 Commit README updates
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action Bot"
          git add .
          
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "📊 Update profile stats [automated]"
            git push
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}